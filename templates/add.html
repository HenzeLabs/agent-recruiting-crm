{% extends "base.html" %} {% block title %}Add Recruit - Gina's Client
Dashboard{% endblock %} {% block content %}
<div class="add-form-container">
  <h2>Add New Recruit</h2>
  <form id="addRecruitForm" method="POST" class="modern-form" novalidate>
    <div class="form-group">
      <label for="name">Name *</label>
      <input
        type="text"
        id="name"
        name="name"
        required
        placeholder="Enter full name"
        aria-describedby="name-error"
      />
      <div id="name-error" class="field-error" role="alert"></div>
    </div>

    <div class="form-group">
      <label for="email">Email</label>
      <input
        type="email"
        id="email"
        name="email"
        placeholder="email@example.com"
        aria-describedby="email-error"
      />
      <div id="email-error" class="field-error" role="alert"></div>
    </div>

    <div class="form-group">
      <label for="phone">Phone</label>
      <input type="tel" id="phone" name="phone" placeholder="(555) 123-4567" />
    </div>

    <div class="form-group">
      <label for="source">Source</label>
      <select id="source" name="source">
        <option value="Referral">Referral</option>
        <option value="Company Portal">Company Portal</option>
        <option value="Self-Generated">Self-Generated</option>
        <option value="Social Media">Social Media</option>
        <option value="Email Campaign">Email Campaign</option>
        <option value="Other">Other</option>
      </select>
    </div>

    <div class="form-group">
      <label for="stage">Stage</label>
      <select id="stage" name="stage">
        <option value="New">New</option>
        <option value="Contacted">Contacted</option>
        <option value="In Training">In Training</option>
        <option value="Licensed">Licensed</option>
        <option value="Inactive">Inactive</option>
      </select>
    </div>

    <div class="form-group">
      <label for="notes">Notes</label>
      <textarea
        id="notes"
        name="notes"
        rows="4"
        placeholder="Add any additional notes..."
      ></textarea>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn-primary">
        <svg
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M12 5v14M5 12h14" />
        </svg>
        Add Recruit
      </button>
      <a href="/" class="btn-secondary">Cancel</a>
    </div>
  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("addRecruitForm");
    const nameInput = document.getElementById("name");
    const emailInput = document.getElementById("email");

    // Real-time validation
    nameInput.addEventListener("blur", validateName);
    emailInput.addEventListener("blur", validateEmail);

    function validateName() {
      const error = document.getElementById("name-error");
      if (!nameInput.value.trim()) {
        error.textContent = "Name is required";
        nameInput.setAttribute("aria-invalid", "true");
        return false;
      }
      error.textContent = "";
      nameInput.setAttribute("aria-invalid", "false");
      return true;
    }

    function validateEmail() {
      const error = document.getElementById("email-error");
      const email = emailInput.value.trim();
      if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        error.textContent = "Please enter a valid email address";
        emailInput.setAttribute("aria-invalid", "true");
        return false;
      }
      error.textContent = "";
      emailInput.setAttribute("aria-invalid", "false");
      return true;
    }

    form.addEventListener("submit", async (e) => {
      console.log("[FORM] Submit event fired");
      // Validate before submit
      const isNameValid = validateName();
      const isEmailValid = validateEmail();

      if (!isNameValid) {
        e.preventDefault();
        nameInput.focus();
        return;
      }

      if (!isEmailValid) {
        e.preventDefault();
        emailInput.focus();
        return;
      }

      // Always use traditional POST for reliability in tests
      // AJAX submission causes race conditions with playwright's waitForURL
      console.log("[FORM] Using traditional POST submission");
      // Form submits normally without preventDefault
    });
  });
</script>
{% endblock %}
